<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map Editor</title>
    <style>
        #svg-container {
            border: 1px solid black;
            margin-top: 10px;
            height: 800px; /* Increased height */
            overflow: hidden;
            position: relative;
            background: #f0f0f0; /* Light background for better visibility */
        }
        svg {
            position: absolute;
            top: 0;
            left: 0;
            cursor: grab;
            transition: transform 0.1s;
        }
        .shape {
            cursor: pointer;
        }
        .zoomable {
            cursor: grab;
        }
        .zoomable:active {
            cursor: grabbing;
        }
        .slider-container {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .slider-label {
            margin-right: 10px;
        }
        .slider {
            -webkit-appearance: none;
            width: 150px;
            height: 15px;
            border-radius: 5px;
            background: #ddd;
            cursor: pointer;
            outline: none;
        }
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
        }
        .slider::-moz-range-thumb {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
        }
        .mode-indicator {
            margin-left: 10px;
        }
        .color-picker-container {
            margin-top: 10px;
            display: flex;
            align-items: center;
        }
        #color-input {
            position: absolute;
            top: 5px;
            left: 320px;
        }
        #download-button {
            position: absolute;
            top: 7px;
            right: 30px;
            padding: 5px 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        #map-dropdown {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
        }
    #upload-input {
            position: absolute;
            top: 10px;
            right: 150px;
        }
    </style>
</head>
<body>
    <div class="slider-container">
        <label for="mode-slider" class="slider-label">Mode:</label>
        <input type="range" id="mode-slider" class="slider" min="0" max="1" step="1" value="0">
        <span id="mode-indicator" class="mode-indicator">Color Mode</span>
    </div>
    <select id="map-dropdown">
        <option value="" selected disabled>Select Map</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/AlabamaMunicipalities.svg">Alabama Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/AlaskaMunicipalities.svg">Alaska Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/ArizonaMunicipalities.svg">Arizona Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/ArkansasMunicipalities.svg">Arkansas Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/CaliforniaMunicipalities.svg">California Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/ColoradoMunicipalities.svg">Colorado Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/ConnecticutMunicipalities.svg">Connecticut Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/DelawareMunicipalities.svg">Delaware Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/FloridaMunicipalities.svg">Florida Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/GeorgiaMunicipalities.svg">Georgia Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/HawaiiMunicipalities.svg">Hawaii Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/IdahoMunicipalities.svg">Idaho Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/IllinoisMunicipalities.svg">Illinois Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/IndianaMunicipalities.svg">Indiana Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/IowaMunicipalities.svg">Iowa Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/KansasMunicipalities.svg">Kansas Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/KentuckyMunicipalities.svg">Kentucky Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/LouisianaMunicipalities.svg">Louisiana Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/MaineMunicipalities.svg">Maine Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/MarylandMunicipalities.svg">Maryland Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/MassachusettsMunicipalities.svg">Massachusetts Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/MichiganMunicipalities.svg">Michigan Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/MinnesotaMunicipalities.svg">Minnesota Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/MississippiMunicipalities.svg">Mississippi Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/MissouriMunicipalities.svg">Missouri Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/MontanaMunicipalities.svg">Montana Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/NebraskaMunicipalities.svg">Nebraska Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/NevadaMunicipalities.svg">Nevada Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/NewHampshireMunicipalities.svg">New Hampshire Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/NewJerseyMunicipalities.svg">New Jersey Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/NewMexicoMunicipalities.svg">New Mexico Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/NewYorkMunicipalities.svg">New York Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/NorthCarolinaMunicipalities.svg">North Carolina Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/NorthDakotaMunicipalities.svg">North Dakota Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/OhioMunicipalities.svg">Ohio Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/OklahomaMunicipalities.svg">Oklahoma Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/OregonMunicipalities.svg">Oregon Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/PennsylvaniaMunicipalities.svg">Pennsylvania Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/RhodeIslandMunicipalities.svg">Rhode Island Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/SouthCarolinaMunicipalities.svg">South Carolina Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/SouthDakotaMunicipalities.svg">South Dakota Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/TennesseeMunicipalities.svg">Tennessee Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/TexasMunicipalities.svg">Texas Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/UtahMunicipalities.svg">Utah Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/VermontMunicipalities.svg">Vermont Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/VirginiaMunicipalities.svg">Virginia Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/WashingtonMunicipalities.svg">Washington Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/WestVirginiaMunicipalities.svg">West Virginia Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/WisconsinMunicipalities.svg">Wisconsin Municipalities</option>
        <option value="https://github.com/bradinator33/bradinator33.github.io/blob/60db8e5f617133d7b5fb76411c59f8a87e0ce4ed/maps/WyomingMunicipalities.svg">Wyoming Municipalities</option>
    </select>
    <input type="color" id="color-input">
    <button id="download-button">Download SVG</button>
    <input type="file" id="upload-input" accept=".svg">

    <div id="svg-container"></div>

    <script>
        const svgContainer = document.getElementById('svg-container');
        const modeSlider = document.getElementById('mode-slider');
        const modeIndicator = document.getElementById('mode-indicator');
        const colorInput = document.getElementById('color-input');
        const downloadButton = document.getElementById('download-button');
        const uploadInput = document.getElementById('upload-input');
        const mapDropdown = document.getElementById('map-dropdown');

        let svgElement = null;
        let isPanning = false;
        let startX, startY;
        let panX = 0, panY = 0;
        let scale = 1;
        let mode = 'color';

        const originalColors = new Map();

        modeSlider.addEventListener('input', () => {
            setMode(modeSlider.value === '0' ? 'color' : 'zoom');
        });

        mapDropdown.addEventListener('change', () => {
            const mapUrl = mapDropdown.value;
            if (mapUrl) {
                fetch(mapUrl)
                    .then(response => response.text())
                    .then(svgContent => displaySvg(svgContent))
                    .catch(error => alert('Failed to load the selected map.'));
            }
        });

        uploadInput.addEventListener('change', event => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = e => {
                    displaySvg(e.target.result);
                };
                reader.readAsText(file);
            }
        });

        colorInput.addEventListener('input', () => {
            colorInput.style.backgroundColor = colorInput.value;
        });

        function setMode(newMode) {
            mode = newMode;
            modeIndicator.textContent = mode === 'color' ? 'Color Mode' : 'Zoom Mode';
            if (svgElement) {
                svgElement.classList.toggle('zoomable', mode === 'zoom');
            }
        }

        function displaySvg(svgContent) {
            svgContainer.innerHTML = svgContent;
            svgElement = svgContainer.querySelector('svg');
            svgElement.style.transform = `translate(${panX}px, ${panY}px) scale(${scale})`;

            svgElement.querySelectorAll('*').forEach(shape => {
                const originalColor = shape.getAttribute('fill') || '#000000';
                originalColors.set(shape, originalColor);
                shape.classList.add('shape');
                shape.addEventListener('click', () => {
                    if (mode === 'color') {
                        shape.setAttribute('fill', colorInput.value);
                    }
                });
                shape.addEventListener('contextmenu', (event) => {
                    event.preventDefault();
                    shape.setAttribute('fill', originalColors.get(shape));
                });
            });

            svgElement.addEventListener('mousedown', startPan);
            svgElement.addEventListener('mousemove', doPan);
            svgElement.addEventListener('mouseup', endPan);
            svgElement.addEventListener('mouseleave', endPan);
            svgElement.addEventListener('wheel', handleZoom);
        }

        function startPan(event) {
            if (mode === 'zoom') {
                isPanning = true;
                startX = event.clientX - panX;
                startY = event.clientY - panY;
                svgElement.style.cursor = 'grabbing';
            }
        }

        function doPan(event) {
            if (isPanning) {
                panX = event.clientX - startX;
                panY = event.clientY - startY;
                svgElement.style.transform = `translate(${panX}px, ${panY}px) scale(${scale})`;
            }
        }

        function endPan() {
            if (isPanning) {
                isPanning = false;
                svgElement.style.cursor = 'grab';
            }
        }

        function handleZoom(event) {
            if (mode === 'zoom') {
                event.preventDefault();
                scale += event.deltaY * -0.01;
                scale = Math.min(Math.max(.125, scale), 10);
                svgElement.style.transform = `translate(${panX}px, ${panY}px) scale(${scale})`;
            }
        }

        downloadButton.addEventListener('click', () => {
            const serializer = new XMLSerializer();
            const svgBlob = new Blob([serializer.serializeToString(svgElement)], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(svgBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'modified_map.svg';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        });

        setMode('color');

        const defaultMapUrl = "https://raw.githubusercontent.com/bradinator33/bradinator33.github.io/0c8e4215b6063392297182772a2729c56c7267c5/maps/MinnesotaMunicipalities.svg";
        fetch(defaultMapUrl).then(response => {
            if (response.ok) {
                return response.text();
            } else {
                throw new Error('Failed to load the default map file.');
            }
        }).then(svgContent => {
            displaySvg(svgContent);
        }).catch(error => {
            alert(error.message);
        });
    </script>
</body>
</html>
